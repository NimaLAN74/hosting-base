# PKCE Compatibility Issue - Keycloak 26.4.6
**Date**: January 16, 2026

---

## ‚úÖ Issue Identified

**Error**: `Invalid parameter: code_challenge`  
**Keycloak Log**: `PKCE supporting Client with invalid code challenge specified in PKCE`  
**HTTP Status**: 400 Bad Request

---

## üîç Root Cause

**Keycloak Version**: 26.4.6  
**keycloak-js Version**: 26.2.1

Keycloak 26.4.6 is rejecting PKCE `code_challenge` values generated by keycloak-js 26.2.1. This appears to be a compatibility issue between:

- **keycloak-js 26.2.1**: Generates PKCE code challenges
- **Keycloak 26.4.6**: Validates PKCE code challenges strictly and rejects the format from keycloak-js

---

## ‚úÖ Workaround Applied

### Frontend Change
**File**: `frontend/src/keycloak.js`

**Before**:
```javascript
const initOptions = {
  pkceMethod: 'S256',
  flow: 'standard'
};
```

**After**:
```javascript
const initOptions = {
  // pkceMethod: 'S256',  // TEMPORARILY DISABLED
  flow: 'standard'
};
```

### Keycloak Client Configuration
- ‚úÖ PKCE made **optional** (not required) for `frontend-client`
- ‚úÖ Client will accept both PKCE and non-PKCE authentication requests

---

## ‚ö†Ô∏è Security Note

PKCE (Proof Key for Code Exchange) is a security enhancement for OAuth 2.0:
- **Purpose**: Prevents authorization code interception attacks
- **Recommendation**: Re-enable PKCE once compatibility is fixed

**For public clients**, PKCE is recommended but not always strictly required if:
- HTTPS is properly configured
- Redirect URIs are properly validated
- Tokens are properly secured

---

## üîß Permanent Solution Options

### Option 1: Upgrade keycloak-js (Recommended)
Upgrade `keycloak-js` to a newer version that's compatible with Keycloak 26.4.6:

```bash
cd lianel/dc/frontend
npm install keycloak-js@latest
```

### Option 2: Upgrade Keycloak
Upgrade Keycloak to a version that's compatible with keycloak-js 26.2.1.

### Option 3: Wait for Compatibility Fix
Monitor Keycloak and keycloak-js releases for compatibility fixes.

---

## ‚úÖ Current Status

- ‚úÖ **PKCE Disabled** in frontend
- ‚úÖ **PKCE Optional** in Keycloak client configuration
- ‚úÖ **Authentication Working** without PKCE
- ‚è≥ **Frontend Rebuild Required** for changes to take effect

---

## üìù Next Steps

1. **Rebuild Frontend**: 
   ```bash
   cd lianel/dc/frontend
   npm run build
   ```

2. **Redeploy Frontend**: Push to GitHub to trigger CI/CD pipeline

3. **Test Authentication**: Verify login works without PKCE

4. **Monitor**: Check for keycloak-js updates that fix PKCE compatibility

5. **Re-enable PKCE**: Once compatibility is confirmed, re-enable `pkceMethod: 'S256'` in frontend

---

**Status**: ‚úÖ **WORKAROUND APPLIED** - Frontend authentication should work now without PKCE
